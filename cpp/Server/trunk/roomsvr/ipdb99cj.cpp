#include <stdio.h>
#include <stdlib.h>
#include <fstream>
#include <iostream>
#include <math.h>
#include "ipdb99cj.h"
//#include "RoomServerApplication.h"

ipdb99cj*	ipdb99cj::m_instance = NULL;
using namespace std;
const char* ispdes[3] = {"电信", "联通", "移动"};


TYcity cncitys[] = {
	{"北京", "010", 14, 116.413554, 39.911013, false,0}
	, {"上海", "021", 21, 121.480237, 31.236305, false,0}
	, {"天津", "022", 15, 117.205914, 39.090908, true,0}
	, {"重庆", "023", 7, 106.557165, 29.570997, false,0}
	, {"香港", "852", 29, 114.171994, 22.281089, false,0}
	, {"澳门", "853", 30, 113.549403, 22.192961, false,0}
	, {"台湾", "00886", 27, 120.961454, 23.80406, false,0}
	, {"邯郸", "0310", 16, 114.545808, 36.631222, false,0}
	, {"石家庄", "0311", 16, 114.520828, 38.048684, false,0}
	, {"保定", "0312", 16, 115.471052, 38.880055, false,0}
	, {"张家口", "0313", 16, 114.894165, 40.830172, false,0}
	, {"承德", "0314", 16, 117.969798, 40.957855, false,0}
	, {"唐山", "0315", 16, 118.187036, 39.636673, false,0}
	, {"廊坊", "0316", 16, 116.69034, 39.54352, true,1}
	, {"沧州", "0317", 16, 116.845272, 38.31022, false,0}
	, {"衡水", "0318", 16, 115.676942, 37.745166, false,0}
	, {"邢台", "0319", 16, 114.510889, 37.076646, false,0}
	, {"秦皇岛", "0335", 16, 119.606184, 39.941259, false,0}
	, {"衢州", "0570", 22, 118.880768, 28.941661, false,0}
	, {"杭州", "0571", 22, 120.161693, 30.280059, false,0}
	, {"湖州", "0572", 22, 120.094566, 30.899015, false,0}
	, {"嘉兴", "0573", 22, 120.762045, 30.750912, false,0}
	, {"宁波", "0574", 22, 121.556686, 29.880177, false,0}
	, {"绍兴", "0575", 22, 120.586673, 30.036519, false,0}
	, {"台州", "0576", 22, 121.426996, 28.662297, false,0}
	, {"温州", "0577", 22, 120.705869, 28.001095, false,0}
	, {"丽水", "0578", 22, 119.929503, 28.472979, false,0}
	, {"金华", "0579", 22, 119.654027, 29.084455, false,0}
	, {"舟山", "0580", 22, 122.214339, 29.991092, false,0}
	, {"沈阳", "024", 33, 123.438973, 41.811339, false,0}
	, {"铁岭", "0410", 33, 123.848797, 42.292573, false,0}
	, {"大连", "0411", 33, 121.621391, 38.919345, false,0}
	, {"鞍山", "0412", 33, 123.000974, 41.114122, false,0}
	, {"抚顺", "0413", 33, 123.963595, 41.886078, false,0}
	, {"本溪", "0414", 33, 123.773468, 41.299847, false,0}
	, {"丹东", "0415", 33, 124.362564, 40.00569, false,0}
	, {"锦州", "0416", 33, 121.133631, 41.100869, false,0}
	, {"营口", "0417", 33, 122.241475, 40.672565, false,0}
	, {"阜新", "0418", 33, 121.676518, 42.027983, true,1}
	, {"辽阳", "0419", 33, 123.243726, 41.274452, false,0}
	, {"朝阳", "0421", 33, 120.457301, 41.579487, false,0}
	, {"盘锦", "0427", 33, 122.077269, 41.125939, false,0}
	, {"葫芦岛", "0429", 33, 120.843388, 40.717364, false,0}
	, {"武汉", "027", 23, 114.311831, 30.598428, false,0}
	, {"襄阳", "0710", 23, 112.129091, 32.014786, true,0}
	, {"鄂州", "0711", 23, 114.901557, 30.396522, false,0}
	, {"孝感", "0712", 23, 113.922962, 30.930712, false,0}
	, {"黄石", "0714", 23, 115.045433, 30.205336, false,0}
	, {"咸宁", "0715", 23, 114.328967, 29.847123, false,0}
	, {"荆州", "0716", 23, 112.24722, 30.340606, false,0}
	, {"宜昌", "0717", 23, 111.292971, 30.697602, false,0}
	, {"恩施", "0718", 23, 109.485727, 30.30089, false,0}
	, {"十堰", "0719", 23, 110.80454, 32.635042, false,0}
	, {"随州", "0722", 23, 113.389071, 31.696341, false,0}
	, {"荆门", "0724", 23, 112.205843, 31.041792, false,0}
	, {"南京", "025", 20, 118.802891, 32.064735, false,0}
	, {"无锡", "0510", 20, 120.318954, 31.496704, true,0}
	, {"镇江", "0511", 20, 119.431494, 32.195688, false,0}
	, {"苏州", "0512", 20, 120.589613, 31.304566, true,2}
	, {"南通", "0513", 20, 120.900301, 31.985237, false,0}
	, {"扬州", "0514", 20, 119.419107, 32.39986, false,0}
	, {"盐城", "0515", 20, 120.168187, 33.355301, false,0}
	, {"徐州", "0516", 20, 117.29235, 34.210143, false,0}
	, {"淮安", "0517", 20, 119.022429, 33.616272, false,0}
	, {"连云港", "0518", 20, 119.229571, 34.602342, false,0}
	, {"常州", "0519", 20, 119.980142, 31.816791, false,0}
	, {"泰州", "0523", 20, 119.932115, 32.4612, false,0}
	, {"呼和浩特", "0471", 11, 111.758518, 40.847461, false,0}
	, {"包头", "0472", 11, 109.846755, 40.663636, false,0}
	, {"乌海", "0473", 11, 106.80185, 39.660154, false,0}
	, {"乌兰察布", "0474", 11, 113.140223, 40.999972, false,0}
	, {"通辽", "0475", 11, 122.251207, 43.658363, false,0}
	, {"赤峰", "0476", 11, 118.895463, 42.264586, false,0}
	, {"巴彦淖尔", "0478", 11, 107.394129, 40.749427, false,0}
	, {"锡林浩特", "0479", 11, 116.09269, 43.939135, false,0}
	, {"乌兰浩特", "0482", 11, 122.099783, 46.078473, false,0}
	, {"阿拉善左旗", "0483", 11, 105.672858, 38.839125, false,0}
	, {"新余", "0790", 24, 114.923664, 27.823541, false,0}
	, {"南昌", "0791", 24, 115.864528, 28.687675, false,0}
	, {"九江", "0792", 24, 116.007993, 29.711328, false,0}
	, {"上饶", "0793", 24, 117.950028, 28.460864, false,0}
	, {"抚州", "0794", 24, 116.364627, 27.953603, false,0}
	, {"宜春", "0795", 24, 114.422683, 27.820089, false,0}
	, {"吉安", "0796", 24, 115.00027, 27.119751, false,0}
	, {"赣州", "0797", 24, 114.94126, 25.837179, false,0}
	, {"景德镇", "0798", 24, 117.184967, 29.274337, false,0}
	, {"萍乡", "0799", 24, 113.86077, 27.62897, false,0}
	, {"鹰潭", "0701", 24, 117.075765, 28.265879, false,0}
	, {"忻州", "0350", 12, 112.740804, 38.422382, false,0}
	, {"太原", "0351", 12, 112.55706, 37.876885, true,1}
	, {"大同", "0352", 12, 113.306446, 40.082539, false,0}
	, {"阳泉", "0353", 12, 113.587087, 37.86234, false,0}
	, {"晋中", "0354", 12, 112.759375, 37.692757, false,0}
	, {"长治", "0355", 12, 113.123046, 36.201585, false,0}
	, {"晋城", "0356", 12, 112.857706, 35.496081, false,0}
	, {"临汾", "0357", 12, 111.526153, 36.094052, false,0}
	, {"吕梁", "0358", 12, 111.148086, 37.525476, false,0}
	, {"运城", "0359", 12, 111.013379, 35.032587, false,0}
	, {"临夏", "0930", 3, 103.24972, 35.610297, false,0}
	, {"兰州", "0931", 3, 103.840692, 36.067312, false,0}
	, {"定西", "0932", 3, 104.631662, 35.587354, false,0}
	, {"平凉", "0933", 3, 106.671741, 35.549266, false,0}
	, {"庆阳", "0934", 3, 107.649305, 35.716096, false,0}
	, {"武威", "0935", 3, 102.644524, 37.934078, false,0}
	, {"张掖", "0936", 3, 100.456221, 38.932187, false,0}
	, {"酒泉", "0937", 3, 98.500427, 39.738615, false,0}
	, {"天水", "0938", 3, 105.731276, 34.587162, false,0}
	, {"白银", "0943", 3, 104.144182, 36.550821, false,0}
	, {"菏泽", "0530", 17, 115.487696, 35.239435, false,0}
	, {"济南", "0531", 17, 117.001319, 36.671627, false,0}
	, {"青岛", "0532", 17, 120.389445, 36.072358, false,0}
	, {"淄博", "0533", 17, 118.061254, 36.819182, false,0}
	, {"德州", "0534", 17, 116.365825, 37.441313, false,0}
	, {"烟台", "0535", 17, 121.454425, 37.469868, false,0}
	, {"潍坊", "0536", 17, 119.168138, 36.713212, false,0}
	, {"济宁", "0537", 17, 116.593852, 35.420269, false,0}
	, {"泰安", "0538", 17, 117.094893, 36.205905, false,0}
	, {"临沂", "0539", 17, 118.36299, 35.110531, false,0}
	, {"哈尔滨", "0451", 31, 126.542417, 45.807782, false,0}
	, {"齐齐哈尔", "0452", 31, 123.924531, 47.360087, false,0}
	, {"牡丹江", "0453", 31, 129.638976, 44.558647, false,0}
	, {"佳木斯", "0454", 31, 130.32696, 46.806581, false,0}
	, {"绥化", "0455", 31, 126.975678, 46.658789, false,0}
	, {"黑河", "0456", 31, 127.535014, 50.251193, false,0}
	, {"伊春", "0458", 31, 128.84704, 47.733329, false,0}
	, {"大庆", "0459", 31, 125.109727, 46.593216, false,0}
	, {"福州", "0591", 26, 119.302938, 26.080447, false,0}
	, {"厦门", "0592", 26, 118.095915, 24.485821, false,0}
	, {"宁德", "0593", 26, 119.554701, 26.671748, false,0}
	, {"莆田", "0594", 26, 119.014232, 25.45996, false,0}
	, {"泉州", "0595", 26, 118.682316, 24.880242, false,0}
	, {"漳州", "0596", 26, 117.653827, 24.519197, false,0}
	, {"龙岩", "0597", 26, 117.023668, 25.081257, false,0}
	, {"三明", "0598", 26, 117.645742, 26.269683, false,0}
	, {"南平", "0599", 26, 118.1843, 26.647662, false,0}
	, {"广州", "020", 28, 113.270793, 23.135308, false,0}
	, {"韶关", "0751", 28, 113.603757, 24.816174, false,0}
	, {"惠州", "0752", 28, 114.423348, 23.116409, false,0}
	, {"梅州", "0753", 28, 116.129179, 24.294311, false,0}
	, {"汕头", "0754", 28, 116.688739, 23.359289, true,2}
	, {"深圳", "0755", 28, 114.066112, 22.548515, false,0}
	, {"珠海", "0756", 28, 113.583235, 22.276392, false,0}
	, {"佛山", "0757", 28, 113.128432, 23.027707, true,0}
	, {"肇庆", "0758", 28, 112.47177, 23.052984, false,0}
	, {"湛江", "0759", 28, 110.365494, 21.277163, false,0}
	, {"中山", "0760", 28, 113.399023, 22.522262, false,0}
	, {"河源", "0762", 28, 114.707097, 23.749829, false,0}
	, {"清远", "0763", 28, 113.062619, 23.688238, false,0}
	, {"云浮", "0766", 28, 112.051045, 22.921154, false,0}
	, {"潮州", "0768", 28, 116.62943, 23.662923, false,0}
	, {"东莞", "0769", 28, 113.758231, 23.026997, true,0}
	, {"汕尾", "0660", 28, 115.381693, 22.791322, false,0}
	, {"阳江", "0662", 28, 111.989051, 21.864421, false,0}
	, {"揭阳", "0663", 28, 116.37922, 23.555773, false,0}
	, {"成都", "028", 4, 104.071216, 30.576279, false,0}
	, {"重庆", "0811", 7, 106.557165, 29.570997, false,0}
	, {"攀枝花", "0812", 7, 101.725262, 26.588109, false,0}
	, {"自贡", "0813", 7, 104.784891, 29.345379, false,0}
	, {"绵阳", "0816", 7, 104.686164, 31.473364, false,0}
	, {"南充", "0817", 7, 106.117231, 30.843297, false,0}
	, {"达州", "0818", 7, 107.474504, 31.214347, false,0}
	, {"遂宁", "0825", 7, 105.599152, 30.539156, false,0}
	, {"广安", "0826", 7, 106.639772, 30.461708, false,0}
	, {"巴中", "0827", 7, 106.753912, 31.872851, false,0}
	, {"泸州", "0830", 7, 105.449092, 28.877577, false,0}
	, {"宜宾", "0831", 7, 104.648103, 28.75761, false,0}
	, {"内江", "0832", 7, 105.065028, 29.585836, false,0}
	, {"乐山", "0833", 7, 103.77193, 29.558141, false,0}
	, {"西昌", "0834", 7, 102.269526, 27.900601, false,0}
	, {"雅安", "0835", 7, 103.04636, 30.021277, false,0}
	, {"德阳", "0838", 7, 104.404319, 31.133105, true,0}
	, {"广元", "0839", 7, 105.849993, 32.441808, false,0}
	, {"泸州", "0840", 7, 105.449092, 28.877577, false,0}
	, {"岳阳", "0730", 25, 113.135679, 29.363262, false,0}
	, {"长沙", "0731", 25, 112.945333, 28.233971, true,0}
	, {"湘潭", "0732", 25, 112.950575, 27.83585, false,0}
	, {"株洲", "0733", 25, 113.140431, 27.833737, false,0}
	, {"衡阳", "0734", 25, 112.578397, 26.899517, false,0}
	, {"郴州", "0735", 25, 113.021311, 25.776711, false,0}
	, {"常德", "0736", 25, 111.704994, 29.037723, false,0}
	, {"益阳", "0737", 25, 112.361677, 28.559818, false,0}
	, {"娄底", "0738", 25, 112.001082, 27.703196, false,0}
	, {"邵阳", "0739", 25, 111.474133, 27.245167, false,0}
	, {"吉首", "0743", 25, 109.704558, 28.268631, false,0}
	, {"张家界", "0744", 25, 110.484925, 29.122477, false,0}
	, {"怀化", "0745", 25, 110.008116, 27.575595, false,0}
	, {"永州", "0746", 25, 111.618703, 26.426612, false,0}
	, {"商丘", "0370", 18, 115.662798, 34.420378, false,0}
	, {"郑州", "0371", 18, 113.631349, 34.753488, true,1}
	, {"安阳", "0372", 18, 114.3996, 36.103649, false,0}
	, {"新乡", "0373", 18, 113.933349, 35.308973, false,0}
	, {"许昌", "0374", 18, 113.858804, 34.041737, false,0}
	, {"平顶山", "0375", 18, 113.198935, 33.772051, false,0}
	, {"信阳", "0376", 18, 114.099264, 32.153186, false,0}
	, {"南阳", "0377", 18, 112.535009, 32.996701, false,0}
	, {"开封", "0378", 18, 114.313904, 34.802941, false,0}
	, {"洛阳", "0379", 18, 112.460033, 34.624376, false,0}
	, {"焦作", "0391", 18, 113.248557, 35.221493, false,0}
	, {"鹤壁", "0392", 18, 114.304044, 35.752656, false,0}
	, {"濮阳", "0393", 18, 115.035917, 35.767586, false,0}
	, {"周口", "0394", 18, 114.703433, 33.631958, false,0}
	, {"漯河", "0395", 18, 114.02323, 33.587703, false,0}
	, {"驻马店", "0396", 18, 114.029465, 33.017546, false,0}
	, {"三门峡", "0398", 18, 111.206832, 34.778442, false,0}
	, {"昭通", "0870", 5, 103.723311, 27.344057, false,0}
	, {"昆明", "0871", 5, 102.839667, 24.885953, false,0}
	, {"大理", "0872", 5, 100.236278, 25.597589, false,0}
	, {"个旧", "0873", 5, 103.166558, 23.364832, false,0}
	, {"曲靖", "0874", 5, 103.802685, 25.496328, false,0}
	, {"保山", "0875", 5, 99.168373, 25.117882, false,0}
	, {"玉溪", "0877", 5, 102.5537, 24.357512, false,0}
	, {"楚雄", "0878", 5, 101.552292, 25.038943, false,0}
	, {"普洱", "0879", 5, 100.97281, 22.830987, false,0}
	, {"景洪", "0691", 5, 100.778141, 22.006109, false,0}
	, {"潞西", "0692", 5, 98.426939, 24.329497, false,0}
	, {"临沧", "0883", 5, 100.09528, 23.89053, false,0}
	, {"丽江", "0888", 5, 100.23357, 26.862521, false,0}
	, {"滁州", "0550", 19, 118.323252, 32.308165, false,0}
	, {"合肥", "0551", 19, 117.235447, 31.82687, false,0}
	, {"蚌埠", "0552", 19, 117.395835, 32.921498, false,0}
	, {"芜湖", "0553", 19, 118.439561, 31.358798, false,0}
	, {"淮南", "0554", 19, 117.006189, 32.631837, false,0}
	, {"马鞍山", "0555", 19, 118.512691, 31.67633, false,0}
	, {"安庆", "0556", 19, 117.070127, 30.548594, false,0}
	, {"宿州", "0557", 19, 116.970454, 33.652034, false,0}
	, {"阜阳", "0558", 19, 115.821389, 32.895879, false,0}
	, {"黄山", "0559", 19, 118.345096, 29.721365, false,0}
	, {"淮北", "0561", 19, 116.804878, 33.96064, false,0}
	, {"铜陵", "0562", 19, 117.818795, 30.950899, false,0}
	, {"宣城", "0563", 19, 118.765196, 30.946576, false,0}
	, {"六安", "0564", 19, 116.529651, 31.741226, false,0}
	, {"巢湖", "0565", 19, 117.88049, 31.608733, false,0}
	, {"池州", "0566", 19, 117.497839, 30.67098, false,0}
	, {"银川", "0951", 6, 106.238976, 38.492392, false,0}
	, {"石嘴山", "0952", 6, 106.39078, 38.989783, false,0}
	, {"吴忠", "0953", 6, 106.205161, 38.003863, false,0}
	, {"固原", "0954", 6, 106.24917, 36.021609, false,0}
	, {"长春", "0431", 32, 125.33017, 43.82178, false,0}
	, {"吉林", "0432", 32, 126.556073, 43.843512, false,0}
	, {"延吉", "0433", 32, 129.515602, 42.897091, false,0}
	, {"四平", "0434", 32, 124.356844, 43.172447, false,0}
	, {"通化", "0435", 32, 125.946506, 41.733906, false,0}
	, {"白城", "0436", 32, 122.845302, 45.6254, false,0}
	, {"辽源", "0437", 32, 125.150107, 42.8943, false,0}
	, {"松原", "0438", 32, 124.831633, 45.147201, false,0}
	, {"白山", "0439", 32, 126.431052, 41.94643, false,0}
	, {"珲春", "0440", 32, 130.372382, 42.868208, false,0}
	, {"防城港", "0770", 10, 108.361138, 21.693439, false,0}
	, {"南宁", "0771", 10, 108.373351, 22.823037, false,0}
	, {"柳州", "0772", 10, 109.42198, 24.331519, false,0}
	, {"桂林", "0773", 10, 110.296442, 25.279893, false,0}
	, {"梧州", "0774", 10, 111.285647, 23.482873, false,0}
	, {"玉林", "0775", 10, 110.18743, 22.660656, false,0}
	, {"百色", "0776", 10, 106.624969, 23.907845, false,0}
	, {"钦州", "0777", 10, 108.66089, 21.985392, false,0}
	, {"河池", "0778", 10, 108.091898, 24.698828, false,0}
	, {"北海", "0779", 10, 109.126614, 21.486955, false,0}
	, {"贵阳", "0851", 8, 106.636816, 26.652747, false,0}
	, {"遵义", "0852", 8, 106.933658, 27.731749, false,0}
	, {"安顺", "0853", 8, 105.952622, 26.259904, false,0}
	, {"都匀", "0854", 8, 107.525074, 26.266108, false,0}
	, {"凯里", "0855", 8, 107.98687, 26.573731, false,0}
	, {"铜仁", "0856", 8, 109.168558, 27.674903, false,0}
	, {"毕节", "0857", 8, 105.333323, 27.408562, false,0}
	, {"六盘水", "0858", 8, 104.836786, 26.599086, false,0}
	, {"兴义", "0859", 8, 104.90199, 25.098139, false,0}
	, {"西安", "029", 9, 108.946306, 34.347436, false,0}
	, {"咸阳", "0910", 9, 108.715712, 34.335599, false,0}
	, {"延安", "0911", 9, 109.496361, 36.591003, false,0}
	, {"榆林", "0912", 9, 109.741195, 38.290886, false,0}
	, {"渭南", "0913", 9, 109.516739, 34.505687, false,0}
	, {"商洛", "0914", 9, 109.94688, 33.876525, false,0}
	, {"安康", "0915", 9, 109.03592, 32.690575, false,0}
	, {"汉中", "0916", 9, 107.030197, 33.07382, false,0}
	, {"宝鸡", "0917", 9, 107.243899, 34.367747, false,0}
	, {"铜川", "0919", 9, 108.951558, 34.902957, false,0}
	, {"西宁", "0971", 2, 101.784269, 36.623477, false,0}
	, {"儋州", "0890", 13, 109.587145, 19.527081, false,0}
	, {"海口", "0898", 13, 110.206424, 20.050057, false,0}
	, {"三亚", "0899", 13, 109.518646, 18.258217, false,0}
	, {"拉萨", "0891", 1, 91.121025, 29.650088, false,0}
	, {"日喀则", "0892", 1, 88.956063, 29.26816, false,0}
	, {"克拉玛依", "0990", 0, 84.89587, 45.585765, false,0}
	, {"乌鲁木齐", "0991", 0, 87.623314, 43.832806, false,0}
	, {"奎屯", "0992", 0, 84.90832, 44.432645, false,0}
	, {"石河子", "0993", 0, 86.085507, 44.312423, false,0}
	, {"昌吉", "0994", 0, 87.273955, 44.020396, false,0}
	, {"吐鲁番", "0995", 0, 89.192419, 42.948489, false,0}
	, {"库尔勒", "0996", 0, 86.180078, 41.732616, false,0}
	, {"阿克苏", "0997", 0, 80.269807, 41.173789, false,0}
	, {"喀什", "0998", 0, 76.000323, 39.473669, false,0}
	, {"伊宁", "0999", 0, 81.28379, 43.915405, false,0}
	, {"塔城", "0901", 0, 82.993651, 46.757212, false,0}
	, {"哈密", "0902", 0, 93.521169, 42.832917, false,0}
	, {"和田", "0903", 0, 79.919624, 37.118013, false,0}
	, {"阿勒泰", "0906", 0, 88.139056, 47.832754, false,0}
	, {"阿图什", "0908", 0, 76.174896, 39.722079, false,0}
	, {"博乐", "0909", 0, 82.057595, 44.859875, false,0}
};

TYcity* nearestcity[citynum][citynum+1];
TYcity* origincity;

double GetDistance(double A1, double B1, double A2, double B2) //计算距离
{
	double tmp = cos(B1)*cos(B2)*cos(A1-A2) + sin(B1)*sin(B2);
	if(tmp >= 1) return 0;
	return 6378.137*acos(tmp);
}
bool less_second(const TYcity* m1, const TYcity* m2)
{
	return GetDistance(m1->x, m1->y, origincity->x, origincity->y) < GetDistance(m2->x, m2->y, origincity->x, origincity->y);
}

ipdbInitwork::ipdbInitwork()
{
	for(int i = 0; i<citynum; ++i)
	{
		cncitys[i].x *= 3.1415926/180;
		cncitys[i].y *= 3.1415926/180;
	}
	updatenearestcity();
	string ipdbpath = string("../etc/") + IPDB99CJNAME;
	ipdb99cj::GetInstance(ipdbpath.c_str());
}

void ipdbInitwork::updatenearestcity()
{
	for(int i = 0; i<citynum; ++i)
	{
		origincity = &cncitys[i];
		int num = 0;
		for(int j = 0; j<citynum; ++j)
		{
			if(cncitys[j].valid) nearestcity[i][num++] = &cncitys[j];
		}
		nearestcity[i][num] = NULL;
		if(num)
			std::sort(&nearestcity[i][0], &nearestcity[i][num], less_second);
	}
}

char* getarea(const char* ip)
{
	unsigned short area;
	unsigned char isp;
	if (ipdb99cj::GetInstance())
		ipdb99cj::GetInstance()->searchip(ip, area, isp);
	//printf("  %s %u\n", cncitys[area].des, (unsigned int)isp);
	for(size_t i = 0; i < citynum; ++i)
	{
		TYcity* pp = nearestcity[area][i];
		if(!pp) break;
		if(pp->ispindex != isp) continue;
		return pp->code;
	}
	return "0769";
}
